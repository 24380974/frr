Release Build Procedure for FRR Maintainers
===========================================

1. Rename branch (if needed)

.. code-block:: shell

   git clone git@github.com:FRRouting/frr.git
   cd frr
   git checkout dev/5.0
   git push origin :refs/heads/dev/5.0
   git push origin dev/5.0:refs/heads/stable/5.0

2. Checkout the new stable branch:

.. code-block:: shell

   git checkout stable/5.0

3. Update Changelog for RedHat Package:

   Edit :file:`redhat/frr.spec.in` and look for the ``%changelog`` section:

   - Change last (top of list) entry from ``%{version}`` to previous fixed
     version number, i.e.::

        * Tue Nov  7 2017 Martin Winter <mwinter@opensourcerouting.org> - %{version}

     to::

        * Tue Nov  7 2017 Martin Winter <mwinter@opensourcerouting.org> - 3.0.2

   - Add new entry to the top of the list with ``%{version}`` tag and changelog
     for version.
     Make sure to watch the format, i.e. the day is always 2 characters, with
     the 1st character being a space if the day is one digit.

4. Update Changelog for Debian Packages:

   Edit :file:`changelog-auto.in`:

   - Insert a new entry AFTER the autogenerated (top of list/first) entry,
     with the appropriate version number (``X.Y.Z-0`` - don't forget the
     ``-0``)::

        frr (23.42-0) testing; urgency=medium

          * upstream 23.42 release

         -- Your Name <your@mail>  timestamp

     The timestamp can be generated with ``date -R``.


5. Change main version number:

    - Edit :file:`configure.ac` and change version in the ``AC_INIT`` command

6. Test building at least a Red Hat and Ubuntu package (or create a PR to have
   the CI system test them)

7. Commit the changes, adding the changelog to the commit message

8. Create a git tag for the version:

   .. code-block:: shell

      git tag -a frr-5.0 -m "FRRouting Release 5.0"

   .. TODO::

      We should really be signing our releases with GPG.

9. Create a dist tarball

   .. code-block:: shell

      tools/tarsource.sh
      xz -dc frr-5.0.tar.xz | gzip -9n > frr-5.0.tar.gz

   If you have tagged the release correctly, it will autodetect that this is
   a release tarball and do the right thing.  If it doesn't, something is
   probably wrong with the tag.

   .. note::

      This action should be run on a recent and well-updated system;  versions
      of autoconf, automake, libtool & co. matter (the dist tarball contains
      copies of files from these packages.)  Don't do it on some ancient
      distribution please.

10. Push the commit and tag(s) and watch for errors on CI:

   .. code-block:: shell

      git push origin refs/tags/frr-5.0

11. Send a Release Announcement with changes to
    ``announce@lists.frrouting.org``

12. After CI plans succeed, release on GitHub by going to
    https://github.com/FRRouting/frr/releases and selecting "Draft a new
    release".  Upload the ``.tar.xz`` and ``.tar.gz`` files you got from
    step 9.
